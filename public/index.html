<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tutor B√≠blico Tito</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style>
 /* ====== ESTILOS GENERALES ====== */

.tito-presentacion {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 12px;
  background-color: #f5f8fa;
  border-radius: 9px;
  padding: 9px;
  margin-bottom: 9px;
}

#tito-img {
  cursor: pointer;
  width: 120px;
  height: auto;
  border-radius: 50%;
  flex-shrink: 0;
  transition: transform 0.3s ease;
}

#presentacion-texto {
  font-size: 1.05rem;
  font-weight: 500;
  line-height: 1.4;
  max-width: 280px;
  margin: 0; /* CLAVE: evita descuadre */
}


/* ====== M√ìVIL ====== */

@media (max-width: 500px) {

  .tito-presentacion {
    gap: 10px;
    padding: 6px;
    max-height: 130px;
  }

  #tito-img {
    width: 75px;
  }

  #presentacion-texto {
    font-size: 0.85rem;
    line-height: 1.3;
    max-width: none;
    text-align: left;
  }

}



    #tito-img {
      cursor: pointer;
      width: 120px;
      height: auto;
      border-radius: 50%;
      flex-shrink: 0;
      transition: transform 0.3s ease;
    }

    #presentacion-texto {
      font-size: 1.15rem;
      font-weight: 500;
      line-height: 1.4;
      max-width: 280px;
    }

    .thinking {
      animation: shake 0.6s infinite;
    }

    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(2deg); }
      50% { transform: rotate(-2deg); }
      75% { transform: rotate(2deg); }
      100% { transform: rotate(0deg); }
    }

    .acordeon-contenido {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
    }

    .acordeon-contenido.activo {
      max-height: 500px;
      padding: 10px;
    }

    @media (max-width: 500px) {
      .tito-presentacion {
        flex-direction: column;
        text-align: center;
      }

      #presentacion-texto {
        max-width: 100%;
        font-size: 1.05rem;
      }
    }
    .botones-accion {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 15px;
  margin-bottom: 20px;
}

.botones-accion button {
  padding: 12px 20px;
  font-size: 1rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

  </style>
</head>

<body style="font-family: Arial, sans-serif; max-width: 650px; margin: auto; padding: 2rem; background-color: #fef9f4; color: #2d3436;">

  <!-- Presentaci√≥n de Tito -->
  <div class="tito-presentacion">
    <img id="tito-img" src="Tito parado.jpg" alt="Tutor Tito" onclick="presentarseTito()" ondblclick="titoBromea()">
    <p id="presentacion-texto">
      Hola soy <strong>Tito</strong>, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.
    </p>
  </div>

  <h1 style="font-size: 1.4rem; font-weight: bold; color: #2980b9;">üìñ Tutor B√≠blico IA</h1>

  <!-- Entrada de texto -->
  <textarea id="input" rows="4" style="width: 100%; padding: 10px; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc;" placeholder="Escribe tu pregunta aqu√≠..."></textarea>
  <br><br>

<!-- Botones -->
<div style="display:flex; gap:12px; margin-top:12px; justify-content:center; flex-wrap:wrap;">

  <button type="button" onclick="enviarMensaje()"
    style="background:#3498db;color:white;padding:10px 20px;
           border:none;border-radius:8px;font-size:1rem;
           cursor:pointer;width:auto;min-width:160px;">
    Enviar pregunta
  </button>

  <button type="button" onclick="reconocerVoz()"
    style="background:#2ecc71;color:white;padding:10px 20px;
           border:none;border-radius:8px;font-size:1rem;
           cursor:pointer;width:auto;min-width:160px;">
    üé§ Dictar
  </button>

  <button type="button" onclick="detenerVoz()"
    style="background:#e74c3c;color:white;padding:10px 20px;
           border:none;border-radius:8px;font-size:1rem;
           cursor:pointer;width:auto;min-width:160px;">
    üõë Detener voz
  </button>

</div>

  <p id="cargando" style="display:none; font-style: italic; color: #888;">‚è≥ Tito est√° pensando...</p>

  <!-- √Årea de respuesta -->
  <h3>Respuesta:</h3>
  <div id="respuesta" style="white-space: pre-wrap; background: #f3f3f3; padding: 1rem; border-radius: 5px;"></div>

  <!-- Bot√≥n y men√∫ de Biblia -->
  <button onclick="toggleMenu()" style="background-color: #8e44ad; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-top: 10px; cursor: pointer;">üìò Aprende sobre la Biblia</button>

  <div id="menu-biblia" style="display: none; margin-top: 1rem;"></div>

  <!-- Script -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById("menu-biblia");
      if (menu.innerHTML === "") {
        const temas = [
          {
            titulo: '1. ¬øQu√© es la Biblia?',
            contenido: 'La Biblia es la Palabra de Dios expresada en lenguaje humano y escrita por autores inspirados, verdaderos autores movidos por el Esp√≠ritu Santo (cf. Dei Verbum 11). Est√° compuesta por 73 libros: 46 del Antiguo Testamento y 27 del Nuevo, redactados entre aproximadamente el siglo X a.C. (inicio de algunas tradiciones y poemas hebreos) y el siglo I d.C. Fue escrita en hebreo, arameo y griego, desde cosmovisiones semitas, helen√≠sticas y precient√≠ficas, propias de sus contextos culturales e hist√≥ricos. La Biblia es una biblioteca que narra progresivamente la historia de la salvaci√≥n, culminada en Cristo, Palabra definitiva del Padre (cf. Heb 1,1‚Äì2). Su unidad revela la fidelidad de Dios y su mensaje debe ser acogido e interpretado en la Iglesia.'
          },
          {
            titulo: '2. Inspiraci√≥n y Revelaci√≥n',
            contenido: 'Dei Verbum (n. 11) ense√±a que la inspiraci√≥n es obra del Esp√≠ritu Santo, que act√∫a en los hagi√≥grafos no como dictado, sino como gracia que les permite reconocer y expresar la presencia de Dios en la historia sagrada. Esta inspiraci√≥n no anula su libertad ni su contexto cultural, sino que los capacita para comunicar, con autenticidad, lo que Dios quiere revelar. La revelaci√≥n, en cambio, es la autocomunicaci√≥n de Dios en la historia de Israel, el pueblo de la alianza, y alcanza su plenitud en Cristo y en la vida de la Iglesia. Ambas realidades se entrelazan: lo revelado acontece en la historia y se consigna por escrito bajo inspiraci√≥n. As√≠, la Escritura transmite verdad salv√≠fica, no necesariamente literal o cient√≠fica.'
          },
          {
            titulo: '3. El canon de la Biblia',
            contenido: 'El canon b√≠blico es el conjunto de libros reconocidos como inspirados por la Iglesia. La Dei Verbum (n. 8) afirma que la Tradici√≥n viva fue clave en su discernimiento. El canon incluye 46 libros del Antiguo Testamento y 27 del Nuevo, definidos en los concilios de Hipona (393) y Cartago (397), y ratificados en Trento (1546). Su conformaci√≥n respondi√≥ a criterios como el uso lit√∫rgico, la apostolicidad y la consonancia doctrinal. El canon expresa la fe viva de la Iglesia bajo la gu√≠a del Esp√≠ritu Santo.'
          },
          {
            titulo: '4. Tipos, g√©neros y formas literarias',
            contenido: 'La Biblia emplea tres tipos literarios principales: narrativa, poes√≠a y discurso. Cada uno alberga diversos g√©neros: en la narrativa hallamos relatos hist√≥ricos y sapienciales; en la poes√≠a, salmos y proverbios; y en el discurso, profec√≠as, ep√≠stolas, evangelios y textos apocal√≠pticos. Estos g√©neros, a su vez, se expresan en formas literarias espec√≠ficas como anuncios de nacimiento (Lc 1), bendiciones (Gn 49), pactos (√âx 19‚Äì24), cr√≥nicas reales, encuentros en pozos (Gn 24; Jn 4), y di√°logos teol√≥gicos (Job). Identificar el dise√±o formal de un pasaje permite discernir no solo su contenido, sino su prop√≥sito comunicativo. Leer la Escritura con atenci√≥n al tipo, g√©nero y forma es esencial para captar su mensaje divino con fidelidad interpretativa.'
          },
          {
            titulo: '5. Contexto cultural e hist√≥rico del Antiguo Testamento',
            contenido: 'El Antiguo Testamento se desarrolla en el entorno del antiguo Cercano Oriente: Mesopotamia, Egipto, Cana√°n. Comparte elementos culturales con estos pueblos, como leyes, relatos de creaci√≥n e instituciones sociales. No obstante, Israel reinterpreta estos elementos desde su fe en un Dios √∫nico, liberador y justo. La alianza, el √âxodo y la profec√≠a muestran c√≥mo Israel se diferencia teol√≥gicamente, afirmando una historia de salvaci√≥n particular en medio de contextos paganos y opresores.'
          },
          {
            titulo: '6. Contexto cultural e hist√≥rico del Nuevo Testamento',
            contenido: 'El Nuevo Testamento surge en una Palestina bajo dominio romano, marcada por tensiones sociales, pol√≠ticas y religiosas. Jes√∫s predica en un mundo influido por la cultura helen√≠stica y dividido entre grupos como fariseos, saduceos y zelotes. Su mensaje del Reino desaf√≠a expectativas mesi√°nicas nacionalistas y propone una salvaci√≥n universal. La Iglesia primitiva, inspirada por el Esp√≠ritu, adapta el Evangelio a contextos grecorromanos, dando origen a una teolog√≠a encarnada en culturas diversas.'
          },
          {
            titulo: '7. La alianza como eje transversal',
            contenido: 'Desde G√©nesis hasta Apocalipsis, la alianza estructura el mensaje b√≠blico. Se expresa en pactos con No√©, Abrah√°n, Mois√©s, David y se cumple en Cristo, mediador de la nueva alianza (Heb 9,15). Esta relaci√≥n con Dios implica fidelidad, elecci√≥n, promesa y cumplimiento. En Jes√∫s, la alianza se universaliza, abarca a toda la humanidad y se sella en la cruz. Leer la Escritura desde esta clave permite captar la unidad profunda del plan salv√≠fico divino.'
          }
        ];

        temas.forEach((tema, i) => {
          const id = i + 1;
          menu.innerHTML += `
            <div>
              <button onclick="toggleContenido(${id})" style="background-color: #3498db; color: white; width: 100%; padding: 10px; margin-bottom: 5px; text-align: left; border: none; border-radius: 6px; cursor: pointer;">${tema.titulo}</button>
              <div id="contenido${id}" class="acordeon-contenido"><p>${tema.contenido}</p></div>
            </div>`;
        });
      }
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    }

    function toggleContenido(num) {
      const contenido = document.getElementById(`contenido${num}`);
      const titoImg = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      if (!contenido.classList.contains("activo")) {
        document.querySelectorAll(".acordeon-contenido").forEach(div => div.classList.remove("activo"));
        contenido.classList.add("activo");
        const texto = contenido.textContent.trim();
        detenerVoz();
        titoImg.src = "Tito explica.png";
        presentacionTexto.textContent = "Presta atenci√≥n";
        hablarConCallback(texto, () => {
          titoImg.src = "Tito parado.jpg";
          presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
        });
      } else {
        contenido.classList.remove("activo");
        detenerVoz();
        titoImg.src = "Tito parado.jpg";
        presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      }
    }

    async function enviarMensaje() {
      const mensaje = document.getElementById('input').value;
      const respuestaDiv = document.getElementById('respuesta');
      const cargando = document.getElementById('cargando');
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      cargando.style.display = 'block';
      respuestaDiv.textContent = '';
      detenerVoz();
      imgTito.src = "Tito pensando.jpg";
      imgTito.classList.add("thinking");
      presentacionTexto.textContent = "Estoy pensando... dame unos segundos.";
      hablar("Estoy pensando... dame unos segundos.");
      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: mensaje })
        });
        const data = await res.json();
        const respuesta = data.reply;
        const emoji = clasificarEmoji(respuesta);
        const final = `${emoji} ${respuesta}`;
        respuestaDiv.textContent = final;
        imgTito.src = "Tito explica.png";
        presentacionTexto.textContent = "Presta atenci√≥n";
        hablar(respuesta);
      } catch (error) {
        respuestaDiv.textContent = '‚ö†Ô∏è Error al conectar con el servidor.';
        console.error(error);
      } finally {
        cargando.style.display = 'none';
        imgTito.classList.remove("thinking");
      }
    }

    function reconocerVoz() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Tu navegador no soporta reconocimiento de voz.');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-PE';
      recognition.onstart = () => document.getElementById('input').placeholder = 'üéôÔ∏è Escuchando...';
      recognition.onresult = (event) => {
        document.getElementById('input').value = event.results[0][0].transcript;
        document.getElementById('input').placeholder = 'Escribe tu pregunta aqu√≠...';
      };
      recognition.onerror = () => alert('Error al reconocer la voz.');
      recognition.start();
    }

    function hablar(texto) {
      speechSynthesis.cancel();
      const mensaje = new SpeechSynthesisUtterance(texto);
      mensaje.lang = 'es-PE';
      speechSynthesis.speak(mensaje);
    }

    function detenerVoz() {
      speechSynthesis.cancel();
    }

    function clasificarEmoji(texto) {
      const lower = texto.toLowerCase();
      if (lower.includes("bien") || lower.includes("alegr√≠a") || lower.includes("esperanza")) return "üòä";
      if (lower.includes("no se puede") || lower.includes("triste") || lower.includes("dificultad")) return "üòî";
      if (lower.includes("advertencia") || lower.includes("cuidado")) return "‚ö†Ô∏è";
      if (lower.includes("cristo") || lower.includes("dios")) return "‚úùÔ∏è";
      return "üí¨";
    }

    function presentarseTito() {
      const saludo = "Hola, soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      document.getElementById("presentacion-texto").textContent = saludo;
      hablar(saludo);
    }

    function titoBromea() {
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      const mensaje = "¬°Me haces cosquillas! ¬øQuieres hacerme una pregunta?";
      imgTito.src = "Tito riendo.png";
      presentacionTexto.textContent = mensaje;
      hablar(mensaje);
      setTimeout(() => {
        imgTito.src = "Tito parado.jpg";
        presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      }, 6000);
    }

    function hablarConCallback(texto, callback) {
      speechSynthesis.cancel();
      const mensaje = new SpeechSynthesisUtterance(texto);
      mensaje.lang = 'es-PE';
      mensaje.onend = callback;
      speechSynthesis.speak(mensaje);
    }
  </script>
</body>
</html>








