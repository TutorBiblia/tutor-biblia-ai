<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tutor B√≠blico Tito</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .thinking {
      animation: shake 0.6s infinite;
    }

    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(2deg); }
      50% { transform: rotate(-2deg); }
      75% { transform: rotate(2deg); }
      100% { transform: rotate(0deg); }
    }
  </style>
</head>
<body style="font-family: Arial, sans-serif; max-width: 650px; margin: auto; padding: 2rem; background-color: #fef9f4; color: #2d3436;">

  <!-- Presentaci√≥n de Tito -->
  <div style="display: flex; align-items: center; background-color: #f5f8fa; border-radius: 12px; padding: 20px; box-shadow: 0px 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
    <img id="tito-img" src="Tito parado.jpg" alt="Tutor Tito"
      onclick="presentarseTito()" ondblclick="titoBromea()"
      style="cursor: pointer; width: 120px; border-radius: 50%; margin-right: 20px; transition: transform 0.3s ease;">
    <p id="presentacion-texto" style="font-size: 1.2rem; font-weight: 500;">
      Hola soy <strong>Tito</strong>, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.
    </p>
  </div>

  <h1 style="font-size: 1.8rem; font-weight: bold; color: #2980b9;">üìñ Tutor B√≠blico IA</h1>

  <!-- Entrada de texto -->
  <textarea id="input" rows="4" style="width: 100%; padding: 10px; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc;" placeholder="Escribe tu pregunta aqu√≠..."></textarea>
  <br><br>

  <!-- Botones -->
  <button onclick="enviarMensaje()" style="background-color: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer;">Enviar pregunta</button>
  <button onclick="reconocerVoz()" style="background-color: #2ecc71; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-left: 10px; cursor: pointer;">üé§ Dictar</button>
  <button onclick="detenerVoz()" style="background-color: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-top: 10px; cursor: pointer;">
    üõë Detener voz
  </button>

  <!-- Indicador de carga -->
  <p id="cargando" style="display:none; font-style: italic; color: #888;">‚è≥ Tito est√° pensando...</p>

  <!-- √Årea de respuesta -->
  <h3>Respuesta:</h3>
  <div id="respuesta" style="white-space: pre-wrap; background: #f3f3f3; padding: 1rem; border-radius: 5px;"></div>

  <!-- Script -->
  <script>
    async function enviarMensaje() {
      const mensaje = document.getElementById('input').value;
      const respuestaDiv = document.getElementById('respuesta');
      const cargando = document.getElementById('cargando');
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");

      cargando.style.display = 'block';
      respuestaDiv.textContent = '';
      detenerVoz();

      // Cambiar imagen a "pensando"
      imgTito.src = "Tito pensando.jpg";
      imgTito.classList.add("thinking");
      presentacionTexto.textContent = "Estoy pensando... dame unos segundos.";
      hablar("Estoy pensando... dame unos segundos.");

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: mensaje })
        });

        const data = await res.json();
        const respuesta = data.reply;

        const emoji = clasificarEmoji(respuesta);
        const final = `${emoji} ${respuesta}`;

        respuestaDiv.textContent = final;

        // Mostrar imagen de explicando
        imgTito.src = "Tito explica.png";
        presentacionTexto.textContent = "Presta atenci√≥n";
        hablar(respuesta);

      } catch (error) {
        respuestaDiv.textContent = '‚ö†Ô∏è Error al conectar con el servidor.';
        console.error(error);
      } finally {
        cargando.style.display = 'none';
        imgTito.classList.remove("thinking");
      }
    }

    function reconocerVoz() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Tu navegador no soporta reconocimiento de voz.');
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-PE';

      recognition.onstart = () => {
        document.getElementById('input').placeholder = 'üéôÔ∏è Escuchando...';
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('input').value = transcript;
        document.getElementById('input').placeholder = 'Escribe tu pregunta aqu√≠...';
      };

      recognition.onerror = () => {
        alert('Error al reconocer la voz.');
      };

      recognition.start();
    }

    function hablar(texto) {
      speechSynthesis.cancel();
      const mensaje = new SpeechSynthesisUtterance(texto);
      mensaje.lang = 'es-PE';
      speechSynthesis.speak(mensaje);
    }

    function detenerVoz() {
      speechSynthesis.cancel();
    }

    function clasificarEmoji(texto) {
      const lower = texto.toLowerCase();
      if (lower.includes("bien") || lower.includes("alegr√≠a") || lower.includes("esperanza")) return "üòä";
      if (lower.includes("no se puede") || lower.includes("triste") || lower.includes("dificultad")) return "üòî";
      if (lower.includes("advertencia") || lower.includes("cuidado")) return "‚ö†Ô∏è";
      if (lower.includes("cristo") || lower.includes("dios")) return "‚úùÔ∏è";
      return "üí¨";
    }

    function presentarseTito() {
      const saludo = "Hola, soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      document.getElementById("presentacion-texto").textContent = saludo;
      hablar(saludo);
    }

    function titoBromea() {
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      const mensaje = "¬°Me haces cosquillas! ¬øQuieres hacerme una pregunta?";

      imgTito.src = "Tito riendo.png";
      presentacionTexto.textContent = mensaje;
      hablar(mensaje);

      setTimeout(() => {
        imgTito.src = "Tito parado.jpg";
        presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      }, 6000);
    }
  </script>

</body>
</html>
<!-- Bot√≥n "Aprende sobre la Biblia" -->
<button onclick="mostrarBiblia()" style="background-color: #8e44ad; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-top: 10px; cursor: pointer;">
  üìò Aprende sobre la Biblia
</button>

<!-- Contenido desplegable con voz -->
<div id="contenido-biblia" style="display: none; background-color: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 1rem; margin-top: 1rem;">

  <h4 onclick="hablarBiblia('biblia1')" style="cursor: pointer; color: #2980b9;">1. ¬øQu√© es la Biblia?</h4>
  <p id="biblia1">La Biblia es una colecci√≥n de libros sagrados que constituyen la revelaci√≥n de Dios a la humanidad, redactada en diversos g√©neros y contextos. No es un libro √∫nico, sino una biblioteca con textos hist√≥ricos, po√©ticos, sapienciales y prof√©ticos, que narran la historia de la salvaci√≥n. Es Palabra de Dios en palabras humanas, y su unidad teol√≥gica se manifiesta en la progresiva revelaci√≥n del plan divino desde la creaci√≥n hasta la plenitud en Cristo.</p>

  <h4 onclick="hablarBiblia('biblia2')" style="cursor: pointer; color: #2980b9;">2. Inspiraci√≥n y Revelaci√≥n</h4>
  <p id="biblia2">La inspiraci√≥n b√≠blica es la acci√≥n del Esp√≠ritu Santo que impulsa a los autores sagrados a escribir lo que Dios quiere comunicar. La revelaci√≥n es la manifestaci√≥n libre de Dios que se da en la historia, especialmente en Jesucristo. La Biblia, entonces, es testimonio de esta revelaci√≥n, interpretada a la luz de la fe y bajo la gu√≠a del magisterio eclesial. No se trata de dictado divino, sino de colaboraci√≥n entre Dios y el ser humano.</p>

  <h4 onclick="hablarBiblia('biblia3')" style="cursor: pointer; color: #2980b9;">3. El canon de la Biblia</h4>
  <p id="biblia3">El canon b√≠blico es el conjunto de libros reconocidos como inspirados por la Iglesia. Su formaci√≥n fue un proceso gradual que culmin√≥ en los primeros siglos cristianos. En la Iglesia cat√≥lica, el canon incluye 73 libros: 46 del Antiguo Testamento y 27 del Nuevo. Este criterio de canonicidad fue guiado por el uso lit√∫rgico, la apostolicidad y la coherencia teol√≥gica con el kerigma cristiano.</p>

  <h4 onclick="hablarBiblia('biblia4')" style="cursor: pointer; color: #2980b9;">4. Tipos, g√©neros y formas literarias</h4>
  <p id="biblia4">La Biblia emplea m√∫ltiples g√©neros literarios: narrativo, po√©tico, legislativo, sapiencial, apocal√≠ptico, entre otros. Comprender estos g√©neros es clave para una interpretaci√≥n adecuada. Por ejemplo, los salmos usan lenguaje simb√≥lico, las par√°bolas tienen funci√≥n pedag√≥gica y los relatos hist√≥ricos comunican teolog√≠a m√°s que cr√≥nica factual. La forma literaria nos orienta hacia el sentido que el autor quiso transmitir bajo inspiraci√≥n divina.</p>

  <h4 onclick="hablarBiblia('biblia5')" style="cursor: pointer; color: #2980b9;">5. Contexto cultural e hist√≥rico del Antiguo Testamento</h4>
  <p id="biblia5">El Antiguo Testamento se desarroll√≥ en un entorno semita, con influencias mesopot√°micas, cananeas y egipcias. Las instituciones sociales, las leyes y las im√°genes teol√≥gicas reflejan este contexto. El √©xodo, por ejemplo, es inseparable del ambiente de opresi√≥n imperial egipcia. Comprender este trasfondo permite ver c√≥mo Israel configur√≥ su fe en di√°logo ‚Äîy a veces en confrontaci√≥n‚Äî con las culturas vecinas.</p>

  <h4 onclick="hablarBiblia('biblia6')" style="cursor: pointer; color: #2980b9;">6. Contexto cultural e hist√≥rico del Nuevo Testamento</h4>
  <p id="biblia6">El Nuevo Testamento surge en el mundo grecorromano, bajo la ocupaci√≥n del Imperio Romano. La lengua com√∫n era el griego, y coexist√≠an corrientes religiosas jud√≠as diversas: fariseos, saduceos, esenios, zelotes. La figura de Jes√∫s y el mensaje cristiano se sit√∫an en este marco, donde el anuncio del Reino contrasta con los poderes pol√≠ticos y religiosos del momento. Este contexto explica muchas tensiones narradas en los evangelios.</p>

  <h4 onclick="hablarBiblia('biblia7')" style="cursor: pointer; color: #2980b9;">7. La alianza como eje transversal</h4>
  <p id="biblia7">La alianza es el hilo conductor que une toda la Biblia. Desde la alianza con No√©, pasando por Abrah√°n, Mois√©s y David, hasta la nueva y eterna alianza en Cristo, Dios se compromete con su pueblo en un v√≠nculo de fidelidad. La alianza expresa la iniciativa divina, la respuesta humana y la dimensi√≥n comunitaria de la fe. En Jes√∫s, la alianza se universaliza y alcanza su plenitud escatol√≥gica.</p>
</div>

<script>
  function mostrarBiblia() {
    const bloque = document.getElementById("contenido-biblia");
    bloque.style.display = bloque.style.display === "none" ? "block" : "none";
  }

  function hablarBiblia(id) {
    detenerVoz();  // Detiene voz anterior si est√° activa
    const texto = document.getElementById(id).textContent;
    hablar(texto); // Usa la funci√≥n ya existente de Tito
  }
</script>








