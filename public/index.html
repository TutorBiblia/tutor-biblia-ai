<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Tutor B√≠blico Tito</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .thinking {
      animation: shake 0.6s infinite;
    }
    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(2deg); }
      50% { transform: rotate(-2deg); }
      75% { transform: rotate(2deg); }
      100% { transform: rotate(0deg); }
    }
    .acordeon-contenido {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
    }
    .acordeon-contenido.activo {
      max-height: 500px;
      padding: 10px;
    }
  </style>
</head>
<body style="font-family: Arial, sans-serif; max-width: 650px; margin: auto; padding: 2rem; background-color: #fef9f4; color: #2d3436;">

  <!-- Presentaci√≥n de Tito -->
  <div style="display: flex; align-items: center; background-color: #f5f8fa; border-radius: 12px; padding: 20px; box-shadow: 0px 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
    <img id="tito-img" src="Tito parado.jpg" alt="Tutor Tito"
      onclick="presentarseTito()" ondblclick="titoBromea()"
      style="cursor: pointer; width: 120px; border-radius: 50%; margin-right: 20px; transition: transform 0.3s ease;">
    <p id="presentacion-texto" style="font-size: 1.2rem; font-weight: 500;">
      Hola soy <strong>Tito</strong>, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.
    </p>
  </div>

  <h1 style="font-size: 1.8rem; font-weight: bold; color: #2980b9;">üìñ Tutor B√≠blico IA</h1>

  <!-- Entrada de texto -->
  <textarea id="input" rows="4" style="width: 100%; padding: 10px; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc;" placeholder="Escribe tu pregunta aqu√≠..."></textarea>
  <br><br>

  <!-- Botones -->
  <button onclick="enviarMensaje()" style="background-color: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer;">Enviar pregunta</button>
  <button onclick="reconocerVoz()" style="background-color: #2ecc71; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-left: 10px; cursor: pointer;">üé§ Dictar</button>
  <button onclick="detenerVoz()" style="background-color: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-top: 10px; cursor: pointer;">üõë Detener voz</button>

  <!-- Indicador de carga -->
  <p id="cargando" style="display:none; font-style: italic; color: #888;">‚è≥ Tito est√° pensando...</p>

  <!-- √Årea de respuesta -->
  <h3>Respuesta:</h3>
  <div id="respuesta" style="white-space: pre-wrap; background: #f3f3f3; padding: 1rem; border-radius: 5px;"></div>

  <!-- Bot√≥n y men√∫ de Biblia -->
  <button onclick="toggleMenu()" style="background-color: #8e44ad; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 1rem; margin-top: 10px; cursor: pointer;">üìò Aprende sobre la Biblia</button>
  <div id="menu-biblia" style="display: none; margin-top: 1rem;"></div>

  <!-- Script principal -->
  <script>
    async function enviarMensaje() {
      const mensaje = document.getElementById('input').value;
      const respuestaDiv = document.getElementById('respuesta');
      const cargando = document.getElementById('cargando');
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      cargando.style.display = 'block';
      respuestaDiv.textContent = '';
      detenerVoz();
      imgTito.src = "Tito pensando.jpg";
      imgTito.classList.add("thinking");
      presentacionTexto.textContent = "Estoy pensando... dame unos segundos.";
      hablar("Estoy pensando... dame unos segundos.");
      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: mensaje })
        });
        const data = await res.json();
        const respuesta = data.reply;
        const emoji = clasificarEmoji(respuesta);
        const final = `${emoji} ${respuesta}`;
        respuestaDiv.textContent = final;
        imgTito.src = "Tito explica.png";
        presentacionTexto.textContent = "Presta atenci√≥n";
        hablar(respuesta);
      } catch (error) {
        respuestaDiv.textContent = '‚ö†Ô∏è Error al conectar con el servidor.';
        console.error(error);
      } finally {
        cargando.style.display = 'none';
        imgTito.classList.remove("thinking");
      }
    }

    function reconocerVoz() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Tu navegador no soporta reconocimiento de voz.');
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-PE';
      recognition.onstart = () => document.getElementById('input').placeholder = 'üéôÔ∏è Escuchando...';
      recognition.onresult = (event) => {
        document.getElementById('input').value = event.results[0][0].transcript;
        document.getElementById('input').placeholder = 'Escribe tu pregunta aqu√≠...';
      };
      recognition.onerror = () => alert('Error al reconocer la voz.');
      recognition.start();
    }

    function hablar(texto) {
      speechSynthesis.cancel();
      const mensaje = new SpeechSynthesisUtterance(texto);
      mensaje.lang = 'es-PE';
      speechSynthesis.speak(mensaje);
    }

    function detenerVoz() {
      speechSynthesis.cancel();
    }

    function clasificarEmoji(texto) {
      const lower = texto.toLowerCase();
      if (lower.includes("bien") || lower.includes("alegr√≠a") || lower.includes("esperanza")) return "üòä";
      if (lower.includes("no se puede") || lower.includes("triste") || lower.includes("dificultad")) return "üòî";
      if (lower.includes("advertencia") || lower.includes("cuidado")) return "‚ö†Ô∏è";
      if (lower.includes("cristo") || lower.includes("dios")) return "‚úùÔ∏è";
      return "üí¨";
    }

    function presentarseTito() {
      const saludo = "Hola, soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      document.getElementById("presentacion-texto").textContent = saludo;
      hablar(saludo);
    }

    function titoBromea() {
      const imgTito = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      const mensaje = "¬°Me haces cosquillas! ¬øQuieres hacerme una pregunta?";
      imgTito.src = "Tito riendo.png";
      presentacionTexto.textContent = mensaje;
      hablar(mensaje);
      setTimeout(() => {
        imgTito.src = "Tito parado.jpg";
        presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      }, 6000);
    }

    function toggleMenu() {
      const menu = document.getElementById("menu-biblia");
      if (menu.innerHTML === "") {
        const temas = [
  {
    titulo: '1. ¬øQu√© es la Biblia?',
    contenido: 'La Biblia es una colecci√≥n de libros inspirados por Dios que revelan progresivamente su voluntad salv√≠fica. Escrita por diversos autores en contextos hist√≥ricos distintos, forma una unidad teol√≥gica centrada en la historia de la alianza entre Dios y su pueblo. No es solo palabra humana sobre Dios, sino Palabra de Dios en palabras humanas (DV 12). A trav√©s de relatos, leyes, profec√≠as y sabidur√≠a, la Biblia orienta a la humanidad hacia su plenitud en Cristo, culminaci√≥n de toda la revelaci√≥n (Heb 1,1‚Äì2).'
  },
  {
    titulo: '2. Inspiraci√≥n y Revelaci√≥n',
    contenido: 'La revelaci√≥n es el acto por el cual Dios se da a conocer libremente en la historia, y la inspiraci√≥n es la acci√≥n del Esp√≠ritu Santo que mueve a los autores b√≠blicos a escribir lo que Dios quiere comunicar. La Sagrada Escritura, entonces, no es dictado, sino fruto de una cooperaci√≥n divina-humana (DV 11). La inspiraci√≥n garantiza la verdad salv√≠fica de los textos, y su interpretaci√≥n exige fe, tradici√≥n viva y gu√≠a del magisterio para captar el sentido pleno en Cristo.'
  },
  {
    titulo: '3. El canon de la Biblia',
    contenido: 'El canon b√≠blico es el conjunto de libros reconocidos como inspirados por la comunidad de fe. En la Iglesia cat√≥lica incluye 46 libros del Antiguo Testamento y 27 del Nuevo. Este discernimiento fue progresivo y dependi√≥ del uso lit√∫rgico, la autoridad apost√≥lica y la coherencia teol√≥gica con la fe recibida. El canon expresa una tradici√≥n viva y normativa: no todo escrito antiguo es Escritura. La autoridad del canon est√° fundamentada en la acci√≥n del Esp√≠ritu Santo que gu√≠a a la Iglesia (cf. 2 Tim 3,16).'
  },
  {
    titulo: '4. Tipos, g√©neros y formas literarias',
    contenido: 'La Biblia no es uniforme en su expresi√≥n: contiene leyes, narraciones, poes√≠a, par√°bolas, discursos prof√©ticos y apocal√≠pticos. Cada forma literaria comunica una verdad teol√≥gica de modo espec√≠fico. Por ejemplo, los salmos cantan la fe del pueblo; las par√°bolas ense√±an el Reino con im√°genes; los relatos del √âxodo narran salvaci√≥n con sentido lit√∫rgico y simb√≥lico. Interpretar correctamente implica respetar los g√©neros, el contexto y la intenci√≥n del autor inspirado, para descubrir el mensaje revelado con fidelidad (cf. DV 12).'
  },
  {
    titulo: '5. Contexto cultural e hist√≥rico del Antiguo Testamento',
    contenido: 'El Antiguo Testamento se configura en di√°logo con culturas del Antiguo Cercano Oriente: Egipto, Mesopotamia y Cana√°n. Las leyes, s√≠mbolos y estructuras sociales muestran influencias compartidas, pero reinterpretadas desde la fe en el Dios √∫nico y libertador. La teolog√≠a del √âxodo, la alianza en el Sina√≠ y la esperanza mesi√°nica surgen en contextos de opresi√≥n, exilio y restauraci√≥n. Este trasfondo permite comprender la originalidad de Israel: una fe que se encarna en la historia, marcada por la memoria de la salvaci√≥n.'
  },
  {
    titulo: '6. Contexto cultural e hist√≥rico del Nuevo Testamento',
    contenido: 'El Nuevo Testamento nace en un mundo helenizado y bajo dominio romano. Jes√∫s vive en una Palestina pluricultural, con tensiones religiosas, pol√≠ticas y sociales. El juda√≠smo del Segundo Templo estaba dividido en grupos como fariseos, saduceos y esenios, cada uno con expectativas escatol√≥gicas. El kerigma cristiano surge como cumplimiento de las promesas del Antiguo Testamento, pero reformula el mesianismo desde la cruz y resurrecci√≥n. El contexto hist√≥rico ilumina el conflicto con las autoridades y la apertura del Evangelio a los gentiles.'
  },
  {
    titulo: '7. La alianza como eje transversal',
    contenido: 'La alianza estructura la revelaci√≥n b√≠blica desde G√©nesis hasta Apocalipsis. Iniciada con No√©, particularizada en Abrah√°n, formalizada en Mois√©s y renovada en David, la alianza expresa el v√≠nculo entre Dios y su pueblo. Esta relaci√≥n implica elecci√≥n, promesa y fidelidad. En Jes√∫s, Dios establece la nueva y eterna alianza sellada con su sangre (Lc 22,20). Esta culminaci√≥n une ley y gracia, justicia y misericordia, y abre la comuni√≥n definitiva con Dios. Toda la Biblia se lee a la luz de esta l√≥gica de alianza.'
  }
];
        temas.forEach((tema, i) => {
          const id = i + 1;
          menu.innerHTML += `<div>
            <button onclick="toggleContenido(${id})" style="background-color: #3498db; color: white; width: 100%; padding: 10px; margin-bottom: 5px; text-align: left; border: none; border-radius: 6px; cursor: pointer;">${tema.titulo}</button>
            <div id="contenido${id}" class="acordeon-contenido"><p>${tema.contenido}</p></div>
          </div>`;
        });
      }
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    }

    function toggleContenido(num) {
      const contenido = document.getElementById(`contenido${num}`);
      const titoImg = document.getElementById("tito-img");
      const presentacionTexto = document.getElementById("presentacion-texto");
      if (!contenido.classList.contains("activo")) {
        document.querySelectorAll(".acordeon-contenido").forEach(div => div.classList.remove("activo"));
        contenido.classList.add("activo");
        const texto = contenido.textContent.trim();
        detenerVoz();
        titoImg.src = "Tito explica.png";
        presentacionTexto.textContent = "Presta atenci√≥n";
        hablarConCallback(texto, () => {
          titoImg.src = "Tito parado.jpg";
          presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
        });
      } else {
        contenido.classList.remove("activo");
        detenerVoz();
        titoImg.src = "Tito parado.jpg";
        presentacionTexto.textContent = "Hola soy Tito, tu tutor virtual. Estoy para acompa√±arte en tu aprendizaje b√≠blico.";
      }
    }

    function hablarConCallback(texto, callback) {
      speechSynthesis.cancel();
      const mensaje = new SpeechSynthesisUtterance(texto);
      mensaje.lang = 'es-PE';
      mensaje.onend = callback;
      speechSynthesis.speak(mensaje);
    }
  </script>
  <!-- Globo de consejos con bot√≥n de cierre -->
<div id="globo-consejo" style="
  display: none;
  position: fixed;
  bottom: 130px;
  right: 30px;
  max-width: 280px;
  background: #ecf0f1;
  border-left: 6px solid #3498db;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.2);
  padding: 15px 15px 10px;
  font-size: 1rem;
  color: #2c3e50;
  z-index: 9999;
  animation: aparecer 0.5s ease-in-out;
">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <strong>‚úç Consejo b√≠blico</strong>
    <button onclick="cerrarConsejo()" style="background: none; border: none; font-size: 1rem; cursor: pointer;">‚ùå</button>
  </div>
  <p id="texto-consejo" style="margin-top: 8px;"></p>
</div>

<script>
// Lista de consejos con color tem√°tico
const consejosBiblicos = [
  { texto: "Conf√≠a en el Se√±or con todo tu coraz√≥n (Prov 3,5).", color: "#2980b9" },
  { texto: "Tu palabra es l√°mpara para mis pasos (Sal 119,105).", color: "#8e44ad" },
  { texto: "No temas, porque yo estoy contigo (Is 41,10).", color: "#c0392b" },
  { texto: "El que cree en m√≠, aunque muera, vivir√° (Jn 11,25).", color: "#16a085" },
  { texto: "Bienaventurados los limpios de coraz√≥n (Mt 5,8).", color: "#f39c12" },
  { texto: "Perdona, como tambi√©n t√∫ has sido perdonado (Col 3,13).", color: "#d35400" },
  { texto: "Haz el bien, busca la paz y s√≠guela (Sal 34,15).", color: "#27ae60" },
  { texto: "Todo lo puedo en Cristo que me fortalece (Flp 4,13).", color: "#34495e" }
];

let globoTimeout;

function mostrarConsejo() {
  const globo = document.getElementById("globo-consejo");
  const texto = document.getElementById("texto-consejo");
  const input = document.getElementById("input");

  // No mostrar si el usuario est√° escribiendo
  if (document.activeElement === input) return;

  const consejo = consejosBiblicos[Math.floor(Math.random() * consejosBiblicos.length)];
  texto.textContent = consejo.texto;
  globo.style.display = "block";
  globo.style.borderLeft = `6px solid ${consejo.color}`;
  hablar(consejo.texto);

  clearTimeout(globoTimeout);
  globoTimeout = setTimeout(() => {
    globo.style.display = "none";
  }, 12000);
}

function cerrarConsejo() {
  const globo = document.getElementById("globo-consejo");
  globo.style.display = "none";
  clearTimeout(globoTimeout);
}

// Mostrar consejo cada 60 segundos
setInterval(mostrarConsejo, 60000);
</script>

<style>
@keyframes aparecer {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}
</style>
</body>
</html>








